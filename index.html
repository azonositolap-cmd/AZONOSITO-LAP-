<<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Azonosító lap</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* { box-sizing: border-box; }
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}
.container {
  background: #fff;
  max-width: 900px;
  margin: auto;
  padding: 30px;
  border: 1px solid #ccc;
}
h2 { text-align: center; margin-bottom: 30px; }
.top-info {
  display: flex;
  justify-content: space-between;
  margin-bottom: 25px;
  font-weight: bold;
}
label { font-weight: bold; display: block; margin-top: 18px; }
input, select, textarea, canvas {
  width: 100%;
  margin-top: 6px;
}
input, select, textarea {
  padding: 10px;
  font-size: 15px;
}
textarea { min-height: 90px; }
.row { display: flex; gap: 20px; }
.row > div { flex: 1; }
canvas {
  border: 1px solid #000;
  height: 150px;
  background: #fff;
}
.checkbox { margin-top: 12px; }
.checkbox label { font-weight: normal; }
button {
  margin-top: 25px;
  padding: 14px;
  width: 100%;
  font-size: 16px;
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>
<div class="container" id="doc">

<h2>Azonosító lap</h2>

<div class="top-info">
  <div>Dátum: <span id="datum"></span></div>
  <div>Érkeztetési szám: <span id="erkszam"></span></div>
</div>

<label>Megbízó neve</label>
<input id="gazdaNev">

<label>Cím</label>
<input id="cim">

<label>Telefonszám</label>
<input type="tel">

<label>Megbízott</label>
<input value="Budai Tamás e.v." readonly>

<label>Állat adatai</label>
<select id="allatFajta">
  <option value="">Válasszon</option>
  <option>Kutya</option>
  <option>Macska</option>
  <option>Egyéb</option>
</select>

<div id="egyebAllat" style="display:none;">
  <label>Milyen állat?</label>
  <input>
</div>

<div class="row">
  <div>
    <label>Név</label>
    <input>
  </div>
  <div>
    <label>Chip szám</label>
    <input>
  </div>
</div>

<div class="row">
  <div>
    <label>Állat neme</label>
    <select>
      <option>Hím</option>
      <option>Nőstény</option>
      <option>Ismeretlen</option>
    </select>
  </div>
  <div>
    <label>Súly (kg)</label>
    <input type="number">
  </div>
</div>

<label>Implantátum?</label>
<div class="checkbox"><label>Igen</label><input type="checkbox"></div>
<div class="checkbox"><label>Nem</label><input type="checkbox"></div>

<label>Milyen urna?</label>
<input>

<label>Urna állapota</label>
<select>
  <option>Ragasztva</option>
  <option>Nem ragasztva</option>
</select>

<label>Fizetés módja</label>
<div class="checkbox"><label>Készpénz</label><input type="checkbox"></div>
<div class="checkbox"><label>Átutalás</label><input type="checkbox"></div>

<label>Megjegyzés</label>
<textarea></textarea>

<label>Megbízó aláírása</label>
<canvas id="signUser"></canvas>

<label>Ügyfél email címe</label>
<input id="ugyfelEmail" type="email">

<button id="pdfBtn">PDF készítés és küldés</button>

</div>

<script>
const d = new Date();
const ds = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
datum.innerText = ds;
let c = localStorage.getItem("erk") || 0;
localStorage.setItem("erk", ++c);
erkszam.innerText = `${ds}-${String(c).padStart(4,"0")}`;

allatFajta.onchange = e =>
  egyebAllat.style.display = e.target.value==="Egyéb" ? "block" : "none";

const canvas = document.getElementById("signUser");
const ctx = canvas.getContext("2d");
canvas.width = canvas.offsetWidth;
canvas.height = 150;
let draw=false;
canvas.onmousedown=e=>{draw=true;ctx.moveTo(e.offsetX,e.offsetY)};
canvas.onmousemove=e=>{if(draw){ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke()}};
canvas.onmouseup=()=>draw=false;

function clean(s){
  return s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]+/g,"_");
}

pdfBtn.onclick = async () => {
  const fileName = `azonosito_${ds}_${clean(gazdaNev.value)}_${clean(cim.value)}.pdf`;

  const pdfBlob = await html2pdf()
    .from(document.getElementById("doc"))
    .set({ html2canvas:{scale:1}, jsPDF:{format:"a4"} })
    .outputPdf("blob");

  const fd = new FormData();
  fd.append("pdf", pdfBlob, fileName);
  fd.append("ugyfelEmail", ugyfelEmail.value);

  await fetch("/send-pdf",{method:"POST",body:fd});
  alert("Kész!");
};
</script>

</body>
</html>
