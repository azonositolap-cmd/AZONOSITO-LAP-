<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Azonos√≠t√≥ lap</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* { box-sizing: border-box; }

body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}

.container {
  background: #fff;
  max-width: 900px;
  margin: auto;
  padding: 30px;
  border: 1px solid #ccc;
}

h2 {
  text-align: center;
  margin-bottom: 30px;
}

.top-info {
  display: flex;
  justify-content: space-between;
  margin-bottom: 25px;
  font-weight: bold;
}

label {
  font-weight: bold;
  display: block;
  margin-top: 18px;
}

input, select, textarea, canvas {
  width: 100%;
  margin-top: 6px;
}

input, select, textarea {
  padding: 10px;
  font-size: 15px;
}

textarea { min-height: 90px; }

.row {
  display: flex;
  gap: 20px;
}

.row > div { flex: 1; }

canvas {
  border: 1px solid #000;
  height: 150px;
}

.checkbox {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 10px;
  padding-bottom: 6px;
  border-bottom: 1px dotted #ccc;
}

button {
  margin-top: 30px;
  padding: 14px;
  width: 100%;
  font-size: 16px;
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>
<div class="container" id="doc">

<h2>Azonos√≠t√≥ lap</h2>

<div class="top-info">
  <div>D√°tum: <span id="datum"></span></div>
  <div>√ârkeztet√©si sz√°m: <span id="erkszam"></span></div>
</div>

<label>Megb√≠z√≥ neve</label>
<input type="text" id="gazdaNev">

<label>C√≠m</label>
<input type="text" id="cim">

<label>Telefonsz√°m</label>
<input type="tel">

<label>Megb√≠zott</label>
<input type="text" readonly value="Budai Tam√°s e.v. | Ad√≥sz√°m: 69528279-1-43 | Nyilv√°ntart√°si sz√°m: 53314194">

<label>√Ållat adatai</label>
<select>
  <option>Kutya</option>
  <option>Macska</option>
</select>

<label>Megjegyz√©s</label>
<textarea></textarea>

<label>Megb√≠z√≥ al√°√≠r√°sa</label>
<canvas id="sign"></canvas>

<label>√úgyf√©l email c√≠me</label>
<input type="email" id="email">

<button id="pdfBtn">PDF k√©sz√≠t√©s √©s k√ºld√©s</button>
</div>

<script>
const d = new Date();
datum.innerText = d.toLocaleDateString("hu-HU");
erkszam.innerText = d.getTime();

const canvas = document.getElementById("sign");
const ctx = canvas.getContext("2d");
canvas.width = canvas.offsetWidth;
canvas.height = 150;
let draw=false;

canvas.onmousedown = e => { draw=true; ctx.moveTo(e.offsetX,e.offsetY); };
canvas.onmousemove = e => { if(draw){ ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke(); }};
canvas.onmouseup = ()=> draw=false;

/* üî• PDF-FLATTEN LOGIKA */
function flattenForPdf(original){
  const clone = original.cloneNode(true);

  clone.querySelectorAll("input, textarea, select").forEach(el=>{
    let value = "";
    if(el.type==="checkbox") value = el.checked ? "‚òë Igen" : "‚òê Nem";
    else if(el.tagName==="SELECT") value = el.options[el.selectedIndex]?.text || "";
    else value = el.value;

    const div = document.createElement("div");
    div.style.padding = "10px";
    div.style.border = "1px solid #ccc";
    div.style.marginTop = "6px";
    div.innerText = value;

    el.replaceWith(div);
  });

  clone.querySelectorAll("canvas").forEach(c=>{
    const img = document.createElement("img");
    img.src = c.toDataURL();
    img.style.width="100%";
    c.replaceWith(img);
  });

  return clone;
}

pdfBtn.onclick = async ()=>{
  const flat = flattenForPdf(document.getElementById("doc"));

  const pdfBlob = await html2pdf().from(flat).set({
    margin: 10,
    image: { type:'jpeg', quality:0.95 },
    html2canvas:{ scale:1.5 },
    jsPDF:{ unit:'mm', format:'a4', orientation:'portrait' }
  }).outputPdf("blob");

  const fd = new FormData();
  fd.append("pdf", pdfBlob, "azonosito.pdf");
  fd.append("email", email.value);

  await fetch("/send-pdf",{ method:"POST", body:fd });
  alert("PDF elk√ºldve");
};
</script>
</body>
</html>
