<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Azonosító lap</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* { box-sizing: border-box; }

body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}

.container {
  background: #fff;
  width: 210mm;
  margin: 0 auto;
  padding: 20mm;
  border: 1px solid #ccc;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

.top-info {
  display: flex;
  justify-content: space-between;
  font-weight: bold;
  margin-bottom: 20px;
}

label {
  font-weight: bold;
  margin-top: 14px;
  display: block;
}

input, select, textarea {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
}

textarea { min-height: 80px; }

.row {
  display: flex;
  gap: 20px;
}

.row > div { flex: 1; }

.checkbox-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 8px;
}

.checkbox-table td {
  padding: 6px 0;
}

.checkbox-table td:last-child {
  width: 30px;
  text-align: right;
}

input[type="checkbox"] {
  transform: scale(1.2);
}

canvas {
  width: 100%;
  height: 150px;
  border: 1px solid #000;
  margin-top: 8px;
}

button {
  margin-top: 20px;
  padding: 14px;
  width: 100%;
  font-size: 16px;
  cursor: pointer;
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>

<div class="container" id="doc">

<h2>Azonosító lap</h2>

<div class="top-info">
  <div>Dátum: <span id="datum"></span></div>
  <div>Érkeztetési szám: <span id="erkszam"></span></div>
</div>

<label>Megbízó neve</label>
<input id="gazdaNev">

<label>Cím</label>
<input id="cim">

<label>Telefonszám</label>
<input>

<label>Megbízott</label>
<input value="Budai Tamás e.v. | Adószám: 69528279143 | Nyilvántartási szám: 53314194" readonly>

<label>Állat fajtája</label>
<select id="allatFajta">
  <option>Kutya</option>
  <option>Macska</option>
  <option>Egyéb</option>
</select>

<div class="row">
  <div>
    <label>Állat neve</label>
    <input>
  </div>
  <div>
    <label>Chip szám</label>
    <input>
  </div>
</div>

<div class="row">
  <div>
    <label>Állat neme</label>
    <select>
      <option>Hím</option>
      <option>Nőstény</option>
      <option>Ismeretlen</option>
    </select>
  </div>
  <div>
    <label>Súly (kg)</label>
    <input type="number">
  </div>
</div>

<label>Implantátum az állat testében?</label>
<table class="checkbox-table">
<tr><td>Igen</td><td><input type="checkbox"></td></tr>
<tr><td>Nem</td><td><input type="checkbox"></td></tr>
</table>

<label>Urna típusa</label>
<input>

<label>Urna állapota</label>
<select>
<option>Ragasztva</option>
<option>Nem ragasztva</option>
</select>

<label>Fizetés módja</label>
<table class="checkbox-table">
<tr><td>Készpénz</td><td><input type="checkbox"></td></tr>
<tr><td>Átutalás (egy összegben)</td><td><input type="checkbox"></td></tr>
</table>

<label>Elszállításnál fizetett összeg (Ft)</label>
<input type="number">

<label>Visszaszállításnál fizetendő összeg (Ft)</label>
<input type="number">

<table class="checkbox-table">
<tr>
<td>A kisállattal együtt átvett pokróc, nyakörv stb. megsemmisítésre kerül.</td>
<td><input type="checkbox"></td>
</tr>
<tr>
<td>Hozzájárulok személyes adataim kezeléséhez</td>
<td><input type="checkbox"></td>
</tr>
</table>

<label>Megjegyzés</label>
<textarea></textarea>

<label>Megbízó aláírása</label>
<canvas id="sign"></canvas>

<label>Ügyfél email címe</label>
<input id="ugyfelEmail" type="email">

<button id="pdfBtn">PDF készítés és küldés</button>

</div>

<script>
// dátum
const d=new Date();
const ds=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
datum.innerText=ds.replaceAll("-", ".");
let c=localStorage.getItem("erk")||0;
localStorage.setItem("erk",++c);
erkszam.innerText=`${ds}-${String(c).padStart(4,"0")}`;

// aláírás
const canvas=document.getElementById("sign");
const ctx=canvas.getContext("2d");
canvas.width=canvas.offsetWidth;
canvas.height=150;
let draw=false;

canvas.onmousedown=e=>{draw=true;ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY);}
canvas.onmousemove=e=>{if(draw){ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke();}}
canvas.onmouseup=()=>draw=false;

// pdf
pdfBtn.onclick=async()=>{
if(!ugyfelEmail.value)return alert("Email kötelező");

const fileName=`azonosito_${ds}_${cim.value.replace(/\s+/g,"_")}.pdf`;

const pdfBlob=await html2pdf().from(doc).set({
html2canvas:{scale:1,width:794,windowWidth:794},
jsPDF:{unit:"mm",format:"a4"}
}).outputPdf("blob");

const fd=new FormData();
fd.append("pdf",pdfBlob,fileName);
fd.append("ugyfelEmail",ugyfelEmail.value);

await fetch("/send-pdf",{method:"POST",body:fd});
alert("PDF elküldve");
};
</script>

</body>
</html>
