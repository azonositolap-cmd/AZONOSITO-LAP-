<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Azonosító lap</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* { box-sizing: border-box; }

html, body {
  width: 210mm;
  margin: 0;
  padding: 0;
  background: #f5f5f5;
  font-family: Arial, sans-serif;
}

.container {
  width: 210mm;
  min-height: 297mm;
  background: #fff;
  margin: auto;
  padding: 20mm;
  border: 1px solid #ccc;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

.top-info {
  display: flex;
  justify-content: space-between;
  font-weight: bold;
  margin-bottom: 20px;
}

label {
  font-weight: bold;
  display: block;
  margin-top: 14px;
}

input, select, textarea, canvas {
  width: 100%;
  margin-top: 5px;
  padding: 8px;
  font-size: 14px;
}

textarea {
  min-height: 80px;
}

.row {
  display: flex;
  gap: 15px;
}

.row > div {
  flex: 1;
}

.checkbox {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px dotted #ccc;
  margin-top: 8px;
  padding-bottom: 4px;
}

.checkbox input {
  width: 20px;
  height: 20px;
}

canvas {
  height: 120px;
  border: 1px solid #000;
}

button {
  margin-top: 20px;
  padding: 14px;
  font-size: 16px;
  width: 100%;
}

label, input, textarea, .row, .checkbox {
  page-break-inside: avoid;
}

@media print {
  body { background: #fff; }
  .container { border: none; }
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>

<div class="container" id="doc">

<h2>Azonosító lap</h2>

<div class="top-info">
  <div>Dátum: <span id="datum"></span></div>
  <div>Érkeztetési szám: <span id="erkszam"></span></div>
</div>

<label>Megbízó neve</label>
<input type="text" id="gazdaNev">

<label>Cím</label>
<input type="text" id="cim">

<label>Telefonszám</label>
<input type="tel">

<label>Megbízott</label>
<input type="text" readonly value="Budai Tamás e.v. | Adószám: 69528279-1-43 | Nyilvántartási szám: 53314194">

<label>Állat adatai</label>
<select id="allatFajta">
  <option value="">Válasszon</option>
  <option>Kutya</option>
  <option>Macska</option>
  <option>Egyéb</option>
</select>

<div id="egyebAllat" style="display:none;">
  <label>Milyen állat?</label>
  <input type="text">
</div>

<div class="row">
  <div>
    <label>Név</label>
    <input type="text">
  </div>
  <div>
    <label>Chip szám</label>
    <input type="text">
  </div>
</div>

<div class="row">
  <div>
    <label>Állat neme</label>
    <select>
      <option>Hím</option>
      <option>Nőstény</option>
      <option>Ismeretlen</option>
    </select>
  </div>
  <div>
    <label>Súly (kg)</label>
    <input type="number">
  </div>
</div>

<label>Található-e implantátum?</label>
<div class="checkbox"><span>Igen</span><input type="checkbox"></div>
<div class="checkbox"><span>Nem</span><input type="checkbox"></div>

<label>Milyen urna?</label>
<input type="text">

<label>Urna állapota</label>
<select>
  <option>Ragasztva</option>
  <option>Nem ragasztva</option>
</select>

<label>Fizetés módja</label>
<div class="checkbox"><span>Készpénz</span><input type="checkbox"></div>
<div class="checkbox"><span>Átutalás</span><input type="checkbox"></div>

<label>Megjegyzés</label>
<textarea></textarea>

<label>Megbízó aláírása</label>
<canvas id="signUser"></canvas>

<label>Ügyfél email címe</label>
<input type="email" id="ugyfelEmail">

<button id="pdfBtn">PDF készítés és küldés</button>

</div>

<script>
const d = new Date();
const ds = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
datum.innerText = ds.replaceAll("-", ".");
let c = localStorage.getItem("erk") || 0;
localStorage.setItem("erk", ++c);
erkszam.innerText = `${ds}-${String(c).padStart(4,"0")}`;

allatFajta.onchange = e => {
  egyebAllat.style.display = e.target.value === "Egyéb" ? "block" : "none";
};

const canvas = document.getElementById("signUser");
const ctx = canvas.getContext("2d");
canvas.width = canvas.offsetWidth;
canvas.height = 120;
let draw = false;

function pos(e){
  const r = canvas.getBoundingClientRect();
  return e.touches
    ? {x:e.touches[0].clientX-r.left,y:e.touches[0].clientY-r.top}
    : {x:e.clientX-r.left,y:e.clientY-r.top};
}

["mousedown","touchstart"].forEach(ev => canvas.addEventListener(ev,e=>{
  draw=true; const p=pos(e); ctx.beginPath(); ctx.moveTo(p.x,p.y);
}));
["mousemove","touchmove"].forEach(ev => canvas.addEventListener(ev,e=>{
  if(!draw) return; const p=pos(e);
  ctx.lineWidth=2; ctx.lineCap="round";
  ctx.lineTo(p.x,p.y); ctx.stroke();
}));
["mouseup","touchend","mouseleave"].forEach(ev => canvas.addEventListener(ev,()=>{
  draw=false; ctx.beginPath();
}));

pdfBtn.onclick = async () => {
  const opt = {
    margin: 0,
    image: { type: 'jpeg', quality: 1 },
    html2canvas: {
      scale: 1,
      scrollX: 0,
      scrollY: 0,
      windowWidth: 794,
      windowHeight: 1123
    },
    jsPDF: {
      unit: 'px',
      format: [794,1123],
      orientation: 'portrait'
    },
    pagebreak: { mode: ['css','legacy'] }
  };

  const blob = await html2pdf().set(opt).from(doc).outputPdf("blob");
  console.log("PDF kész:", blob);
};
</script>

</body>
</html>
